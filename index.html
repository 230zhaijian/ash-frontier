<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ash Frontier (PWA Offline)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<style>
body {
  margin: 0;
  overflow: hidden;
  background-color: #000;
  color: #fff;
  font-family: sans-serif;
  touch-action: manipulation;
  user-select: none;
  height: 100vh;
  width: 100vw;
  display: flex;
  justify-content: center;
  align-items: center;
}
#gameCanvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  pointer-events: none;
}
#ui {
  position: fixed;
  bottom: 5%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 30px;
  z-index: 100;
}
button {
  padding: 20px 50px;
  font-size: 22px;
  background: #222;
  color: #fff;
  border: 2px solid #aaa;
  border-radius: 10px;
}
button:active {
  background: #555;
}
#log {
  position: fixed;
  left: 10px;
  bottom: 10px;
  width: 45%;
  height: 150px;
  background: rgba(0,0,0,0.5);
  color: #0f0;
  font-size: 14px;
  overflow-y: auto;
  z-index: 200;
  padding: 10px;
  border: 1px solid #444;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="ui">
  <button id="startBtn">Start</button>
  <button id="pauseBtn">Pause</button>
  <button id="speedBtn">√ó3</button>
</div>
<div id="log"></div>

<script>
// --- PWA Service Worker ÁôªÈå≤ ---
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('serviceWorker.js')
    .then(() => console.log('Service Worker registered'))
    .catch(err => console.error('SW registration failed:', err));
}

// --- „É≠„Ç∞Èñ¢Êï∞ ---
const logBox = document.getElementById('log');
function log(msg) {
  logBox.innerHTML += msg + '<br>';
  logBox.scrollTop = logBox.scrollHeight;
}
log('üü¢ PWAËµ∑Âãï');

// --- Canvas ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// --- „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ ---
let running = false;
let speed = 1;
let frame = 0;

function gameLoop() {
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#0f0';
  ctx.font = '32px sans-serif';
  ctx.fillText('Ash Frontier (Offline)', 40, 60);
  ctx.fillText('Frame: ' + frame, 40, 100);

  if (running) {
    frame++;
    if (frame % 30 === 0) log('Êé¢Á¥¢‰∏≠... „Éé„Éº„Éâ ' + Math.floor(frame/30));
  }
  setTimeout(gameLoop, 1000/30 / speed);
}

// --- „Ç§„Éô„É≥„ÉàÁôªÈå≤ ---
function bindTouch(el, fn) {
  el.addEventListener('touchstart', e => {
    e.preventDefault();
    fn();
  }, {passive: false});
  el.addEventListener('pointerdown', fn, {passive: true});
}

const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const speedBtn = document.getElementById('speedBtn');

bindTouch(startBtn, () => { running = true; log('‚ñ∂ Êé¢Á¥¢ÈñãÂßã'); });
bindTouch(pauseBtn, () => { running = false; log('‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢'); });
bindTouch(speedBtn, () => { speed = (speed === 1 ? 3 : 1); log('‚è© ÈÄüÂ∫¶: √ó' + speed); });

gameLoop();
</script>
</body>
</html>
