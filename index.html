<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Ash Frontier PWA ÂÆâÂÆöÁâà</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<style>
html, body {
  margin:0; padding:0;
  width:100vw; height:100vh;
  overflow:hidden;
  background:#000; color:#0f0;
  font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
  touch-action: manipulation;
  user-select: none;
}
#gameCanvas {
  position:fixed; top:0; left:0; width:100%; height:100%;
  z-index:0; pointer-events:none; background:#000;
}
#ui {
  position: fixed;
  bottom: env(safe-area-inset-bottom,5%);
  left: 50%;
  transform: translateX(-50%);
  display: flex; gap: 20px;
  z-index: 100;
}
button {
  padding: 16px 40px;
  font-size: 18px;
  background:#222; color:#0f0;
  border: 2px solid #aaa; border-radius: 10px;
  touch-action: manipulation;
}
button:active { background:#555; }
#log {
  position:fixed; left:10px;
  width:45%; max-height:30%;
  background: rgba(0,0,0,0.5); color:#0f0;
  font-size:14px; overflow-y:auto; z-index:50;
  padding:10px; border:1px solid #444; box-sizing:border-box;
}
@media (max-width:600px){
  button { padding:12px 30px; font-size:16px; }
  #log { width:90%; max-height:25%; }
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="ui">
  <button id="startBtn">Start</button>
  <button id="pauseBtn">Pause</button>
  <button id="speedBtn">√ó3</button>
</div>
<div id="log"></div>

<script>
// Service Worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('serviceWorker.js').catch(e=>console.error(e));
}

// „É≠„Ç∞
const logBox = document.getElementById('log');
function log(msg){ logBox.innerHTML += msg + '<br>'; logBox.scrollTop=logBox.scrollHeight; }
log('üü¢ PWAËµ∑Âãï');

// Canvas
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
function resizeCanvas(){
  canvas.width = window.innerWidth * window.devicePixelRatio;
  canvas.height = window.innerHeight * window.devicePixelRatio;
  ctx.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0);
}
window.addEventListener('resize', resizeCanvas);
window.addEventListener('orientationchange', resizeCanvas);
resizeCanvas();

// „Ç≤„Éº„É†Áä∂ÊÖã
let running=false, speed=1, frame=0;

// „Ç≤„Éº„É†„É´„Éº„Éó
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#0f0';
  ctx.font=(32*window.devicePixelRatio)+'px sans-serif';
  ctx.fillText('Ash Frontier (Offline)',40,60*window.devicePixelRatio);
  ctx.fillText('Frame: '+frame,40,100*window.devicePixelRatio);
  if(running){
    frame++;
    if(frame%30===0) log('Êé¢Á¥¢‰∏≠‚Ä¶ „Éé„Éº„Éâ '+Math.floor(frame/30));
  }
  setTimeout(gameLoop,(1000/30)/speed);
}

// „Çø„ÉÉ„ÉÅÂØæÂøú
function bindTouch(el, fn){
  el.addEventListener('touchstart', e=>{ e.preventDefault(); fn(); },{passive:false});
  el.addEventListener('pointerdown', fn,{passive:true});
}

const startBtn=document.getElementById('startBtn');
const pauseBtn=document.getElementById('pauseBtn');
const speedBtn=document.getElementById('speedBtn');

bindTouch(startBtn, ()=>{ running=true; log('‚ñ∂ Êé¢Á¥¢ÈñãÂßã'); adjustLog(); });
bindTouch(pauseBtn, ()=>{ running=false; log('‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢'); });
bindTouch(speedBtn, ()=>{ speed=(speed===1?3:1); log('‚è© ÈÄüÂ∫¶ √ó'+speed); });

// „É≠„Ç∞„Çí„Éú„Çø„É≥‰∏ä„Å´Ëá™ÂãïÈÖçÁΩÆ
const ui=document.getElementById('ui');
function adjustLog(){
  const rect=ui.getBoundingClientRect();
  logBox.style.bottom=(window.innerHeight-rect.top+10)+'px';
}
adjustLog();
window.addEventListener('resize', adjustLog);
window.addEventListener('orientationchange', adjustLog);

gameLoop();
</script>
</body>
</html>
